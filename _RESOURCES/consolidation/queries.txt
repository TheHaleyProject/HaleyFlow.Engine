 internal class QRY_CATEGORY {
     public const string EXISTS_BY_ID = $@"SELECT 1 FROM category WHERE id = {ID} LIMIT 1;";
     public const string EXISTS_BY_NAME = $@"SELECT 1 FROM category WHERE name = {NAME} LIMIT 1;";

     public const string GET_BY_ID = $@"SELECT id, display_name, name FROM category WHERE id = {ID} LIMIT 1;";
     public const string GET_BY_NAME = $@"SELECT id, display_name, name FROM category WHERE name = {NAME} LIMIT 1;";

     public const string LIST_ALL = $@"SELECT id, display_name, name FROM category ORDER BY id;";

     // NOTE: category.name is GENERATED from display_name (do not set name)
     public const string INSERT = $@"INSERT INTO category (display_name) VALUES ({DISPLAY_NAME});";
     public const string UPDATE = $@"UPDATE category SET display_name = {DISPLAY_NAME} WHERE id = {ID};";
     public const string DELETE = $@"DELETE FROM category WHERE id = {ID};";
 }

 internal class QRY_DEFINITION {
    public const string EXISTS_BY_ID = $@"SELECT 1 FROM definition WHERE id = {ID} LIMIT 1;";
    public const string EXISTS_BY_GUID = $@"SELECT 1 FROM definition WHERE guid = {GUID} LIMIT 1;";
    public const string EXISTS_BY_PARENT_AND_NAME = $@"SELECT 1 FROM definition WHERE env = {PARENT_ID} AND name = {NAME} LIMIT 1;";

    public const string GET_BY_ID = $@"SELECT id, guid, env, display_name, name, description, created FROM definition WHERE id = {ID} LIMIT 1;";
    public const string GET_BY_GUID = $@"SELECT id, guid, env, display_name, name, description, created FROM definition WHERE guid = {GUID} LIMIT 1;";
    public const string GET_BY_PARENT_AND_NAME = $@"SELECT id, guid, env, display_name, name, description, created FROM definition WHERE env = {PARENT_ID} AND name = {NAME} LIMIT 1;";

    public const string LIST_BY_PARENT = $@"SELECT id, guid, env, display_name, name, description, created FROM definition WHERE env = {PARENT_ID} ORDER BY id;";

    // NOTE: definition.name is GENERATED from display_name (do not set name)
    public const string INSERT = $@"INSERT INTO definition (env, display_name, description) VALUES ({PARENT_ID}, {DISPLAY_NAME}, {DESCRIPTION});";
    public const string UPDATE = $@"UPDATE definition SET env = {PARENT_ID}, display_name = {DISPLAY_NAME}, description = {DESCRIPTION} WHERE id = {ID};";
    public const string DELETE = $@"DELETE FROM definition WHERE id = {ID};";
}

  internal class QRY_DEFVERSION {
      public const string EXISTS_BY_ID = $@"SELECT 1 FROM def_version WHERE id = {ID} LIMIT 1;";
      public const string EXISTS_BY_GUID = $@"SELECT 1 FROM def_version WHERE guid = {GUID} LIMIT 1;";
      public const string EXISTS_BY_PARENT_AND_VERSION = $@"SELECT 1 FROM def_version WHERE parent = {PARENT_ID} AND version = {VERSION} LIMIT 1;";

      public const string GET_BY_ID = $@"SELECT id, guid, parent, version, data, created, modified FROM def_version WHERE id = {ID} LIMIT 1;";
      public const string GET_BY_GUID = $@"SELECT id, guid, parent, version, data, created, modified FROM def_version WHERE guid = {GUID} LIMIT 1;";
      public const string GET_LATEST_BY_PARENT = $@"SELECT id, guid, parent, version, data, created, modified FROM def_version WHERE parent = {PARENT_ID} ORDER BY version DESC LIMIT 1;";

      public const string LIST_BY_PARENT = $@"SELECT id, guid, parent, version, created, modified FROM def_version WHERE parent = {PARENT_ID} ORDER BY version DESC;";

      public const string INSERT = $@"INSERT INTO def_version (parent, version, data) VALUES ({PARENT_ID}, {VERSION}, {DATA});";
      public const string UPDATE_DATA = $@"UPDATE def_version SET data = {DATA} WHERE id = {ID};";
      public const string DELETE = $@"DELETE FROM def_version WHERE id = {ID};";
      public const string DELETE_BY_PARENT = $@"DELETE FROM def_version WHERE parent = {PARENT_ID};";
  }

  internal class QRY_ENVIRONMENT {
    public const string EXISTS_BY_ID = $@"SELECT 1 FROM environment WHERE id = {ID} LIMIT 1;";
    public const string EXISTS_BY_NAME = $@"SELECT 1 FROM environment WHERE name = {NAME} LIMIT 1;";
    public const string EXISTS_BY_CODE = $@"SELECT 1 FROM environment WHERE code = {CODE} LIMIT 1;";
    public const string EXISTS_BY_GUID = $@"SELECT 1 FROM environment WHERE guid = {GUID} LIMIT 1;";

    public const string GET_BY_ID = $@"SELECT id, display_name, name, code, guid FROM environment WHERE id = {ID} LIMIT 1;";
    public const string GET_BY_NAME = $@"SELECT id, display_name, name, code, guid FROM environment WHERE name = {NAME} LIMIT 1;";
    public const string GET_BY_CODE = $@"SELECT id, display_name, name, code, guid FROM environment WHERE code = {CODE} LIMIT 1;";
    public const string GET_BY_GUID = $@"SELECT id, display_name, name, code, guid FROM environment WHERE guid = {GUID} LIMIT 1;";

    public const string LIST_ALL = $@"SELECT id, display_name, name, code, guid FROM environment ORDER BY id;";

    public const string INSERT = $@"INSERT INTO environment (display_name, code) VALUES ({DISPLAY_NAME}, {CODE});";
    public const string UPDATE = $@"UPDATE environment SET display_name = {DISPLAY_NAME}, code = {CODE} WHERE id = {ID};";
    public const string DELETE = $@"DELETE FROM environment WHERE id = {ID};";
}

 internal class QRY_EVENTS {
     public const string EXISTS_BY_ID = $@"SELECT 1 FROM events WHERE id = {ID} LIMIT 1;";
     public const string EXISTS_BY_PARENT_AND_CODE = $@"SELECT 1 FROM events WHERE def_version = {PARENT_ID} AND code = {CODE} LIMIT 1;";
     public const string EXISTS_BY_PARENT_AND_NAME = $@"SELECT 1 FROM events WHERE def_version = {PARENT_ID} AND name = {NAME} LIMIT 1;";

     public const string GET_BY_ID = $@"SELECT id, def_version, display_name, name, code FROM events WHERE id = {ID} LIMIT 1;";
     public const string GET_BY_PARENT_AND_CODE = $@"SELECT id, def_version, display_name, name, code FROM events WHERE def_version = {PARENT_ID} AND code = {CODE} LIMIT 1;";
     public const string GET_BY_PARENT_AND_NAME = $@"SELECT id, def_version, display_name, name, code FROM events WHERE def_version = {PARENT_ID} AND name = {NAME} LIMIT 1;";

     public const string LIST_BY_PARENT = $@"SELECT id, def_version, display_name, name, code FROM events WHERE def_version = {PARENT_ID} ORDER BY id;";

     // NOTE: events.name is GENERATED from display_name (do not set name)
     public const string INSERT = $@"INSERT INTO events (def_version, display_name, code) VALUES ({PARENT_ID}, {DISPLAY_NAME}, {CODE});";
     public const string UPDATE = $@"UPDATE events SET display_name = {DISPLAY_NAME}, code = {CODE} WHERE id = {ID};";
     public const string DELETE = $@"DELETE FROM events WHERE id = {ID};";
     public const string DELETE_BY_PARENT = $@"DELETE FROM events WHERE def_version = {PARENT_ID};";
 }

  internal class QRY_POLICY {
     public const string EXISTS_BY_ID = $@"SELECT 1 FROM policy WHERE id = {ID} LIMIT 1;";
     public const string EXISTS_BY_HASH = $@"SELECT 1 FROM policy WHERE hash = {HASH} LIMIT 1;";

     public const string GET_BY_ID = $@"SELECT id, hash, content, created FROM policy WHERE id = {ID} LIMIT 1;";
     public const string GET_BY_HASH = $@"SELECT id, hash, content, created FROM policy WHERE hash = {HASH} LIMIT 1;";

     public const string INSERT = $@"INSERT INTO policy (hash, content) VALUES ({HASH}, {CONTENT});";
     public const string UPSERT_BY_HASH_RETURN_ID = $@"INSERT INTO policy (hash, content) VALUES ({HASH}, {CONTENT}) ON DUPLICATE KEY UPDATE id = LAST_INSERT_ID(id); SELECT LAST_INSERT_ID() AS policy_id;";
     public const string UPDATE_CONTENT = $@"UPDATE policy SET content = {CONTENT} WHERE id = {ID};";
     public const string DELETE = $@"DELETE FROM policy WHERE id = {ID};";

     // def_policies: PRIMARY KEY(definition, policy)
     public const string EXISTS_ATTACHMENT = $@"SELECT 1 FROM def_policies WHERE definition = {PARENT_ID} AND policy = {ID} LIMIT 1;";
     public const string ATTACH_TO_DEFINITION = $@"INSERT INTO def_policies (definition, policy) VALUES ({PARENT_ID}, {ID});";
     public const string DETACH_FROM_DEFINITION = $@"DELETE FROM def_policies WHERE definition = {PARENT_ID} AND policy = {ID};";
     public const string LIST_BY_DEFINITION = $@"SELECT p.id, p.hash, p.content, p.created, dp.created AS attached_created FROM def_policies dp JOIN policy p ON p.id = dp.policy WHERE dp.definition = {PARENT_ID} ORDER BY dp.created DESC, p.id ASC;";
 }

  internal class QRY_STATE {
     public const string EXISTS_BY_ID = $@"SELECT 1 FROM state WHERE id = {ID} LIMIT 1;";
     public const string EXISTS_BY_PARENT_AND_NAME = $@"SELECT 1 FROM state WHERE def_version = {PARENT_ID} AND name = {NAME} LIMIT 1;";

     public const string GET_BY_ID = $@"SELECT id, def_version, display_name, name, category, flags, timeout_minutes, timeout_mode, timeout_event, created FROM state WHERE id = {ID} LIMIT 1;";
     public const string GET_BY_PARENT_AND_NAME = $@"SELECT id, def_version, display_name, name, category, flags, timeout_minutes, timeout_mode, timeout_event, created FROM state WHERE def_version = {PARENT_ID} AND name = {NAME} LIMIT 1;";

     public const string LIST_BY_PARENT = $@"SELECT id, def_version, display_name, name, category, flags, timeout_minutes, timeout_mode, timeout_event, created FROM state WHERE def_version = {PARENT_ID} ORDER BY id;";
     public const string LIST_BY_PARENT_WITH_CATEGORY = $@"SELECT s.id, s.def_version, s.display_name, s.name, s.category, c.display_name AS category_display_name, c.name AS category_name, s.flags, s.timeout_minutes, s.timeout_mode, s.timeout_event, s.created FROM state s LEFT JOIN category c ON c.id = s.category WHERE s.def_version = {PARENT_ID} ORDER BY s.id;";

     // NOTE: state.name is GENERATED from display_name (do not set name)
     public const string INSERT = $@"INSERT INTO state (def_version, display_name, category, flags, timeout_minutes, timeout_mode, timeout_event) VALUES ({PARENT_ID}, {DISPLAY_NAME}, {CATEGORY_ID}, {FLAGS}, {TIMEOUT_MINUTES}, {TIMEOUT_MODE}, {TIMEOUT_EVENT});";
     public const string UPDATE = $@"UPDATE state SET display_name = {DISPLAY_NAME}, category = {CATEGORY_ID}, flags = {FLAGS}, timeout_minutes = {TIMEOUT_MINUTES}, timeout_mode = {TIMEOUT_MODE}, timeout_event = {TIMEOUT_EVENT} WHERE id = {ID};";
     public const string DELETE = $@"DELETE FROM state WHERE id = {ID};";
     public const string DELETE_BY_PARENT = $@"DELETE FROM state WHERE def_version = {PARENT_ID};";
 }

  internal class QRY_TRANSITION {
     public const string EXISTS_BY_ID = $@"SELECT 1 FROM transition WHERE id = {ID} LIMIT 1;";
     public const string EXISTS_BY_KEY = $@"SELECT 1 FROM transition WHERE def_version = {PARENT_ID} AND from_state = {FROM_ID} AND to_state = {TO_ID} AND event = {EVENT_ID} LIMIT 1;";

     public const string GET_BY_ID = $@"SELECT id, def_version, from_state, to_state, event, created FROM transition WHERE id = {ID} LIMIT 1;";
     public const string GET_BY_KEY = $@"SELECT id, def_version, from_state, to_state, event, created FROM transition WHERE def_version = {PARENT_ID} AND from_state = {FROM_ID} AND to_state = {TO_ID} AND event = {EVENT_ID} LIMIT 1;";
     public const string GET_BY_FROM_AND_EVENT = $@"SELECT id, def_version, from_state, to_state, event, created FROM transition WHERE def_version = {PARENT_ID} AND from_state = {FROM_ID} AND event = {EVENT_ID} ORDER BY id LIMIT 1;";

     public const string LIST_BY_PARENT = $@"SELECT id, def_version, from_state, to_state, event, created FROM transition WHERE def_version = {PARENT_ID} ORDER BY id;";

     public const string INSERT = $@"INSERT INTO transition (def_version, from_state, to_state, event) VALUES ({PARENT_ID}, {FROM_ID}, {TO_ID}, {EVENT_ID});";
     public const string UPDATE = $@"UPDATE transition SET from_state = {FROM_ID}, to_state = {TO_ID}, event = {EVENT_ID} WHERE id = {ID};";
     public const string DELETE = $@"DELETE FROM transition WHERE id = {ID};";
     public const string DELETE_BY_PARENT = $@"DELETE FROM transition WHERE def_version = {PARENT_ID};";
 }

 internal class QRY_ACK {
    public const string EXISTS_BY_ID = $@"SELECT 1 FROM ack WHERE id = {ID} LIMIT 1;";
    public const string EXISTS_BY_GUID = $@"SELECT 1 FROM ack WHERE guid = {GUID} LIMIT 1;";
    public const string EXISTS_BY_CONSUMER_AND_SOURCE = $@"SELECT 1 FROM ack WHERE consumer = {CONSUMER_ID} AND source = {SOURCE_ID} LIMIT 1;";

    public const string GET_BY_ID = $@"SELECT id, guid, consumer, source, ack_status, last_retry, retry_count, created, modified FROM ack WHERE id = {ID} LIMIT 1;";
    public const string GET_BY_GUID = $@"SELECT id, guid, consumer, source, ack_status, last_retry, retry_count, created, modified FROM ack WHERE guid = {GUID} LIMIT 1;";
    public const string GET_BY_CONSUMER_AND_SOURCE = $@"SELECT id, guid, consumer, source, ack_status, last_retry, retry_count, created, modified FROM ack WHERE consumer = {CONSUMER_ID} AND source = {SOURCE_ID} LIMIT 1;";

    public const string LIST_BY_STATUS_PAGED = $@"SELECT id, guid, consumer, source, ack_status, last_retry, retry_count, created, modified FROM ack WHERE ack_status = {ACK_STATUS} ORDER BY modified LIMIT {TAKE} OFFSET {SKIP};";
    public const string LIST_BY_CONSUMER_AND_STATUS_PAGED = $@"SELECT id, guid, consumer, source, ack_status, last_retry, retry_count, created, modified FROM ack WHERE consumer = {CONSUMER_ID} AND ack_status = {ACK_STATUS} ORDER BY modified LIMIT {TAKE} OFFSET {SKIP};";

    // Retry / monitor helpers
    public const string LIST_READY_FOR_RETRY = $@"SELECT id, guid, consumer, source, ack_status, last_retry, retry_count, created, modified FROM ack WHERE ack_status = {ACK_STATUS} AND last_retry < {OLDER_THAN} ORDER BY last_retry;";
    public const string MARK_RETRY = $@"UPDATE ack SET retry_count = retry_count + 1, last_retry = CURRENT_TIMESTAMP() WHERE id = {ID};";
    public const string SET_STATUS = $@"UPDATE ack SET ack_status = {ACK_STATUS} WHERE id = {ID};";

    public const string INSERT = $@"INSERT INTO ack (consumer, source, ack_status) VALUES ({CONSUMER_ID}, {SOURCE_ID}, {ACK_STATUS});";
    public const string INSERT_WITH_GUID = $@"INSERT INTO ack (guid, consumer, source, ack_status) VALUES ({GUID}, {CONSUMER_ID}, {SOURCE_ID}, {ACK_STATUS});";
    public const string UPSERT_BY_CONSUMER_AND_SOURCE_RETURN_ID = $@"INSERT INTO ack (consumer, source, ack_status) VALUES ({CONSUMER_ID}, {SOURCE_ID}, {ACK_STATUS}) ON DUPLICATE KEY UPDATE id = LAST_INSERT_ID(id);";

    public const string DELETE = $@"DELETE FROM ack WHERE id = {ID};";
    public const string DELETE_BY_CONSUMER_AND_SOURCE = $@"DELETE FROM ack WHERE consumer = {CONSUMER_ID} AND source = {SOURCE_ID};";
}

 internal class QRY_ACK_DISPATCH {
     //LIFECYCLE DISPATCH

     public const string LIST_PENDING_LC_READY = $@"SELECT a.id AS ack_id, a.guid AS ack_guid, a.consumer, a.source, a.ack_status, a.last_retry, a.retry_count, a.created AS ack_created, a.modified AS ack_modified, l.id AS lc_id, l.instance_id, l.from_state, l.to_state, l.event, l.created AS lc_created, i.guid AS instance_guid, i.external_ref, d.actor, d.payload FROM ack a JOIN lc_ack la ON la.ack_id = a.id JOIN lifecycle l ON l.id = la.lc_id JOIN instance i ON i.id = l.instance_id LEFT JOIN lc_data d ON d.lc_id = l.id WHERE a.ack_status = {ACK_STATUS} AND (a.last_retry IS NULL OR a.last_retry < {OLDER_THAN}) ORDER BY a.last_retry ASC, a.id ASC;";

     public const string LIST_PENDING_LC_READY_PAGED = $@"SELECT a.id AS ack_id, a.guid AS ack_guid, a.consumer, a.source, a.ack_status, a.last_retry, a.retry_count, a.created AS ack_created, a.modified AS ack_modified, l.id AS lc_id, l.instance_id, l.from_state, l.to_state, l.event, l.created AS lc_created, i.guid AS instance_guid, i.external_ref, d.actor, d.payload FROM ack a JOIN lc_ack la ON la.ack_id = a.id JOIN lifecycle l ON l.id = la.lc_id JOIN instance i ON i.id = l.instance_id LEFT JOIN lc_data d ON d.lc_id = l.id WHERE a.ack_status = {ACK_STATUS} AND (a.last_retry IS NULL OR a.last_retry < {OLDER_THAN}) ORDER BY a.last_retry ASC, a.id ASC LIMIT {TAKE} OFFSET {SKIP};";

     public const string LIST_PENDING_LC_READY_BY_CONSUMER = $@"SELECT a.id AS ack_id, a.guid AS ack_guid, a.consumer, a.source, a.ack_status, a.last_retry, a.retry_count, a.created AS ack_created, a.modified AS ack_modified, l.id AS lc_id, l.instance_id, l.from_state, l.to_state, l.event, l.created AS lc_created, i.guid AS instance_guid, i.external_ref, d.actor, d.payload FROM ack a JOIN lc_ack la ON la.ack_id = a.id JOIN lifecycle l ON l.id = la.lc_id JOIN instance i ON i.id = l.instance_id LEFT JOIN lc_data d ON d.lc_id = l.id WHERE a.consumer = {CONSUMER} AND a.ack_status = {ACK_STATUS} AND (a.last_retry IS NULL OR a.last_retry < {OLDER_THAN}) ORDER BY a.last_retry ASC, a.id ASC;";

     public const string COUNT_PENDING_LC_READY = $@"SELECT COUNT(1) AS pending_count FROM ack a JOIN lc_ack la ON la.ack_id = a.id WHERE a.ack_status = {ACK_STATUS} AND (a.last_retry IS NULL OR a.last_retry < {OLDER_THAN});";

    //HOOK DISPATCH
     public const string LIST_PENDING_HOOK_READY = $@"SELECT a.id AS ack_id, a.guid AS ack_guid, a.consumer, a.source, a.ack_status, a.last_retry, a.retry_count, a.created AS ack_created, a.modified AS ack_modified, h.id AS hook_id, h.instance_id, h.state_id, h.via_event, h.on_entry, h.route, h.created AS hook_created, i.guid AS instance_guid, i.external_ref FROM ack a JOIN hook_ack ha ON ha.ack_id = a.id JOIN hook h ON h.id = ha.hook_id JOIN instance i ON i.id = h.instance_id WHERE a.ack_status = {ACK_STATUS} AND (a.last_retry IS NULL OR a.last_retry < {OLDER_THAN}) ORDER BY a.last_retry ASC, a.id ASC;";

     public const string LIST_PENDING_HOOK_READY_PAGED = $@"SELECT a.id AS ack_id, a.guid AS ack_guid, a.consumer, a.source, a.ack_status, a.last_retry, a.retry_count, a.created AS ack_created, a.modified AS ack_modified, h.id AS hook_id, h.instance_id, h.state_id, h.via_event, h.on_entry, h.route, h.created AS hook_created, i.guid AS instance_guid, i.external_ref FROM ack a JOIN hook_ack ha ON ha.ack_id = a.id JOIN hook h ON h.id = ha.hook_id JOIN instance i ON i.id = h.instance_id WHERE a.ack_status = {ACK_STATUS} AND (a.last_retry IS NULL OR a.last_retry < {OLDER_THAN}) ORDER BY a.last_retry ASC, a.id ASC LIMIT {TAKE} OFFSET {SKIP};";

     public const string LIST_PENDING_HOOK_READY_BY_CONSUMER = $@"SELECT a.id AS ack_id, a.guid AS ack_guid, a.consumer, a.source, a.ack_status, a.last_retry, a.retry_count, a.created AS ack_created, a.modified AS ack_modified, h.id AS hook_id, h.instance_id, h.state_id, h.via_event, h.on_entry, h.route, h.created AS hook_created, i.guid AS instance_guid, i.external_ref FROM ack a JOIN hook_ack ha ON ha.ack_id = a.id JOIN hook h ON h.id = ha.hook_id JOIN instance i ON i.id = h.instance_id WHERE a.consumer = {CONSUMER} AND a.ack_status = {ACK_STATUS} AND (a.last_retry IS NULL OR a.last_retry < {OLDER_THAN}) ORDER BY a.last_retry ASC, a.id ASC;";

     public const string COUNT_PENDING_HOOK_READY = $@"SELECT COUNT(1) AS pending_count FROM ack a JOIN hook_ack ha ON ha.ack_id = a.id WHERE a.ack_status = {ACK_STATUS} AND (a.last_retry IS NULL OR a.last_retry < {OLDER_THAN});";
 }

 internal class QRY_ACK_HOOK {
    public const string EXISTS = $@"SELECT 1 FROM hook_ack WHERE ack_id = {ACK_ID} AND hook_id = {HOOK_ID} LIMIT 1;";
    public const string EXISTS_BY_ACK_ID = $@"SELECT 1 FROM hook_ack WHERE ack_id = {ACK_ID} LIMIT 1;";
    public const string EXISTS_BY_HOOK_ID = $@"SELECT 1 FROM hook_ack WHERE hook_id = {HOOK_ID} LIMIT 1;";

    public const string LIST_BY_ACK_ID = $@"SELECT ack_id, hook_id FROM hook_ack WHERE ack_id = {ACK_ID} ORDER BY hook_id;";
    public const string LIST_BY_HOOK_ID = $@"SELECT ack_id, hook_id FROM hook_ack WHERE hook_id = {HOOK_ID} ORDER BY ack_id;";

    public const string ATTACH = $@"INSERT INTO hook_ack (ack_id, hook_id) VALUES ({ACK_ID}, {HOOK_ID});";
    public const string DETACH = $@"DELETE FROM hook_ack WHERE ack_id = {ACK_ID} AND hook_id = {HOOK_ID};";

    public const string DELETE_BY_ACK_ID = $@"DELETE FROM hook_ack WHERE ack_id = {ACK_ID};";
    public const string DELETE_BY_HOOK_ID = $@"DELETE FROM hook_ack WHERE hook_id = {HOOK_ID};";

    public const string PENDING_ACKS = $@"SELECT a.id AS ack_id, a.consumer, a.ack_status, a.last_retry, a.retry_count, h.id AS hook_id, h.instance_id, h.state_id, h.via_event, h.on_entry, h.route, h.created FROM ack a JOIN hook_ack ha ON ha.ack_id = a.id JOIN hook h ON h.id = ha.hook_id WHERE a.ack_status = {ACK_STATUS} ORDER BY a.last_retry;";
}

internal class QRY_ACK_LC {
    public const string EXISTS = $@"SELECT 1 FROM lc_ack WHERE ack_id = {ACK_ID} AND lc_id = {LC_ID} LIMIT 1;";
    public const string EXISTS_BY_ACK_ID = $@"SELECT 1 FROM lc_ack WHERE ack_id = {ACK_ID} LIMIT 1;";
    public const string EXISTS_BY_LC_ID = $@"SELECT 1 FROM lc_ack WHERE lc_id = {LC_ID} LIMIT 1;";

    public const string LIST_BY_ACK_ID = $@"SELECT ack_id, lc_id FROM lc_ack WHERE ack_id = {ACK_ID} ORDER BY lc_id;";
    public const string LIST_BY_LC_ID = $@"SELECT ack_id, lc_id FROM lc_ack WHERE lc_id = {LC_ID} ORDER BY ack_id;";

    public const string ATTACH = $@"INSERT INTO lc_ack (ack_id, lc_id) VALUES ({ACK_ID}, {LC_ID});";
    public const string DETACH = $@"DELETE FROM lc_ack WHERE ack_id = {ACK_ID} AND lc_id = {LC_ID};";

    public const string DELETE_BY_ACK_ID = $@"DELETE FROM lc_ack WHERE ack_id = {ACK_ID};";
    public const string DELETE_BY_LC_ID = $@"DELETE FROM lc_ack WHERE lc_id = {LC_ID};";

    public const string PENDING_ACKS = $@"SELECT a.id AS ack_id, a.consumer, a.ack_status, a.last_retry, a.retry_count, l.id AS lc_id, l.instance_id, l.from_state, l.to_state, l.event, l.created FROM ack a JOIN lc_ack la ON la.ack_id = a.id JOIN lifecycle l ON l.id = la.lc_id WHERE a.ack_status = {ACK_STATUS} ORDER BY a.last_retry;";
}

internal class QRY_ACTIVITY {
    public const string EXISTS_BY_ID = $@"SELECT 1 FROM activity WHERE id = {ID} LIMIT 1;";
    public const string EXISTS_BY_NAME = $@"SELECT 1 FROM activity WHERE name = {NAME} LIMIT 1;";

    public const string GET_BY_ID = $@"SELECT id, display_name, name FROM activity WHERE id = {ID} LIMIT 1;";
    public const string GET_BY_NAME = $@"SELECT id, display_name, name FROM activity WHERE name = {NAME} LIMIT 1;";

    public const string LIST_ALL = $@"SELECT id, display_name, name FROM activity ORDER BY id;";

    public const string INSERT = $@"INSERT INTO activity (display_name) VALUES ({DISPLAY_NAME});";
    public const string UPDATE = $@"UPDATE activity SET display_name = {DISPLAY_NAME} WHERE id = {ID};";
    public const string DELETE = $@"DELETE FROM activity WHERE id = {ID};";
}

  internal class QRY_ACTIVITY_STATUS {
      public const string EXISTS_BY_ID = $@"SELECT 1 FROM activity_status WHERE id = {ID} LIMIT 1;";
      public const string EXISTS_BY_NAME = $@"SELECT 1 FROM activity_status WHERE name = {NAME} LIMIT 1;";

      public const string GET_BY_ID = $@"SELECT id, display_name, name FROM activity_status WHERE id = {ID} LIMIT 1;";
      public const string GET_BY_NAME = $@"SELECT id, display_name, name FROM activity_status WHERE name = {NAME} LIMIT 1;";

      public const string LIST_ALL = $@"SELECT id, display_name, name FROM activity_status ORDER BY id;";

      public const string INSERT = $@"INSERT INTO activity_status (display_name) VALUES ({DISPLAY_NAME});";
      public const string UPDATE = $@"UPDATE activity_status SET display_name = {DISPLAY_NAME} WHERE id = {ID};";
      public const string DELETE = $@"DELETE FROM activity_status WHERE id = {ID};";
  }

   internal class QRY_HOOK {
     public const string EXISTS_BY_ID = $@"SELECT 1 FROM hook WHERE id = {ID} LIMIT 1;";
     public const string EXISTS_BY_KEY = $@"SELECT 1 FROM hook WHERE instance_id = {INSTANCE_ID} AND state_id = {STATE_ID} AND via_event = {EVENT_ID} AND on_entry = {ON_ENTRY} AND route = {ROUTE} LIMIT 1;";

     public const string GET_BY_ID = $@"SELECT id, instance_id, state_id, via_event, on_entry, route, created FROM hook WHERE id = {ID} LIMIT 1;";
     public const string LIST_BY_INSTANCE = $@"SELECT id, instance_id, state_id, via_event, on_entry, route, created FROM hook WHERE instance_id = {INSTANCE_ID} ORDER BY id;";
     public const string LIST_BY_INSTANCE_AND_STATE = $@"SELECT id, instance_id, state_id, via_event, on_entry, route, created FROM hook WHERE instance_id = {INSTANCE_ID} AND state_id = {STATE_ID} ORDER BY id;";
     public const string LIST_BY_INSTANCE_STATE_ENTRY = $@"SELECT id, instance_id, state_id, via_event, on_entry, route, created FROM hook WHERE instance_id = {INSTANCE_ID} AND state_id = {STATE_ID} AND on_entry = {ON_ENTRY} ORDER BY id;";

     public const string INSERT = $@"INSERT INTO hook (instance_id, state_id, via_event, on_entry, route) VALUES ({INSTANCE_ID}, {STATE_ID}, {EVENT_ID}, {ON_ENTRY}, {ROUTE});";
     public const string UPSERT_BY_KEY_RETURN_ID = $@"INSERT INTO hook (instance_id, state_id, via_event, on_entry, route) VALUES ({INSTANCE_ID}, {STATE_ID}, {EVENT_ID}, {ON_ENTRY}, {ROUTE}) ON DUPLICATE KEY UPDATE id = LAST_INSERT_ID(id);";

     public const string DELETE = $@"DELETE FROM hook WHERE id = {ID};";
     public const string DELETE_BY_INSTANCE = $@"DELETE FROM hook WHERE instance_id = {INSTANCE_ID};";
 }
 internal class QRY_INSTANCE {
    public const string EXISTS_BY_ID = $@"SELECT 1 FROM instance WHERE id = {ID} LIMIT 1;";
    public const string EXISTS_BY_GUID = $@"SELECT 1 FROM instance WHERE guid = {GUID} LIMIT 1;";
    public const string EXISTS_BY_PARENT_AND_EXTERNAL_REF = $@"SELECT 1 FROM instance WHERE def_version = {PARENT_ID} AND external_ref = {EXTERNAL_REF} LIMIT 1;";

    public const string GET_BY_ID = $@"SELECT id, guid, external_ref, def_version, current_state, last_event, policy_id, flags, created, modified FROM instance WHERE id = {ID} LIMIT 1;";
    public const string GET_BY_GUID = $@"SELECT id, guid, external_ref, def_version, current_state, last_event, policy_id, flags, created, modified FROM instance WHERE guid = {GUID} LIMIT 1;";
    public const string GET_BY_PARENT_AND_EXTERNAL_REF = $@"SELECT id, guid, external_ref, def_version, current_state, last_event, policy_id, flags, created, modified FROM instance WHERE def_version = {PARENT_ID} AND external_ref = {EXTERNAL_REF} LIMIT 1;";

    public const string LIST_BY_PARENT = $@"SELECT id, guid, external_ref, def_version, current_state, last_event, policy_id, flags, created, modified FROM instance WHERE def_version = {PARENT_ID} ORDER BY id;";
    public const string LIST_BY_EXTERNAL_REF = $@"SELECT id, guid, external_ref, def_version, current_state, last_event, policy_id, flags, created, modified FROM instance WHERE external_ref = {EXTERNAL_REF} ORDER BY id;";
    public const string LIST_BY_CURRENT_STATE = $@"SELECT id, guid, external_ref, def_version, current_state, last_event, policy_id, flags, created, modified FROM instance WHERE current_state = {STATE_ID} ORDER BY id;";

    public const string LIST_WHERE_FLAGS_ANY = $@"SELECT id, guid, external_ref, def_version, current_state, last_event, policy_id, flags, created, modified FROM instance WHERE (flags & {FLAGS}) <> 0 ORDER BY id;";
    public const string LIST_WHERE_FLAGS_NONE = $@"SELECT id, guid, external_ref, def_version, current_state, last_event, policy_id, flags, created, modified FROM instance WHERE (flags & {FLAGS}) = 0 ORDER BY id;";

    public const string INSERT = $@"INSERT INTO instance (def_version, external_ref, current_state, last_event, policy_id, flags) VALUES ({PARENT_ID}, {EXTERNAL_REF}, {STATE_ID}, {EVENT_ID}, {POLICY_ID}, {FLAGS});";
    public const string UPSERT_BY_PARENT_AND_EXTERNAL_REF_RETURN_ID = $@"INSERT INTO instance (def_version, external_ref, current_state, last_event, policy_id, flags) VALUES ({PARENT_ID}, {EXTERNAL_REF}, {STATE_ID}, {EVENT_ID}, {POLICY_ID}, {FLAGS}) ON DUPLICATE KEY UPDATE id = LAST_INSERT_ID(id);";

    public const string UPDATE_CURRENT_STATE = $@"UPDATE instance SET current_state = {STATE_ID}, last_event = {EVENT_ID} WHERE id = {ID};";
    public const string UPDATE_CURRENT_STATE_CAS = $@"UPDATE instance SET current_state = {TO_ID}, last_event = {EVENT_ID} WHERE id = {ID} AND current_state = {FROM_ID};";

    public const string SET_FLAGS = $@"UPDATE instance SET flags = {FLAGS} WHERE id = {ID};";
    public const string ADD_FLAGS = $@"UPDATE instance SET flags = (flags | {FLAGS}) WHERE id = {ID};";
    public const string REMOVE_FLAGS = $@"UPDATE instance SET flags = (flags & ~{FLAGS}) WHERE id = {ID};";

    public const string SET_POLICY = $@"UPDATE instance SET policy_id = {POLICY_ID} WHERE id = {ID};";
    public const string SET_EXTERNAL_REF = $@"UPDATE instance SET external_ref = {EXTERNAL_REF} WHERE id = {ID};";

    public const string DELETE = $@"DELETE FROM instance WHERE id = {ID};";
}

 internal class QRY_LC_DATA {
     public const string EXISTS_BY_ID = $@"SELECT 1 FROM lc_data WHERE lc_id = {ID} LIMIT 1;";
     public const string GET_BY_ID = $@"SELECT lc_id, actor, payload FROM lc_data WHERE lc_id = {ID} LIMIT 1;";
     public const string UPSERT = $@"INSERT INTO lc_data (lc_id, actor, payload) VALUES ({ID}, {ACTOR}, {PAYLOAD}) ON DUPLICATE KEY UPDATE actor = VALUES(actor), payload = VALUES(payload);";
     public const string DELETE = $@"DELETE FROM lc_data WHERE lc_id = {ID};";
 }

  internal class QRY_LIFECYCLE {
     public const string EXISTS_BY_ID = $@"SELECT 1 FROM hook WHERE id = {ID} LIMIT 1;";
     public const string EXISTS_BY_KEY = $@"SELECT 1 FROM hook WHERE instance_id = {INSTANCE_ID} AND state_id = {STATE_ID} AND via_event = {EVENT_ID} AND on_entry = {ON_ENTRY} AND route = {ROUTE} LIMIT 1;";

     public const string GET_BY_ID = $@"SELECT id, instance_id, state_id, via_event, on_entry, route, created FROM hook WHERE id = {ID} LIMIT 1;";
     public const string LIST_BY_INSTANCE = $@"SELECT id, instance_id, state_id, via_event, on_entry, route, created FROM hook WHERE instance_id = {INSTANCE_ID} ORDER BY id;";
     public const string LIST_BY_INSTANCE_AND_STATE = $@"SELECT id, instance_id, state_id, via_event, on_entry, route, created FROM hook WHERE instance_id = {INSTANCE_ID} AND state_id = {STATE_ID} ORDER BY id;";
     public const string LIST_BY_INSTANCE_STATE_ENTRY = $@"SELECT id, instance_id, state_id, via_event, on_entry, route, created FROM hook WHERE instance_id = {INSTANCE_ID} AND state_id = {STATE_ID} AND on_entry = {ON_ENTRY} ORDER BY id;";

     public const string INSERT = $@"INSERT INTO hook (instance_id, state_id, via_event, on_entry, route) VALUES ({INSTANCE_ID}, {STATE_ID}, {EVENT_ID}, {ON_ENTRY}, {ROUTE});";
     public const string UPSERT_BY_KEY_RETURN_ID = $@"INSERT INTO hook (instance_id, state_id, via_event, on_entry, route) VALUES ({INSTANCE_ID}, {STATE_ID}, {EVENT_ID}, {ON_ENTRY}, {ROUTE}) ON DUPLICATE KEY UPDATE id = LAST_INSERT_ID(id);";

     public const string DELETE = $@"DELETE FROM hook WHERE id = {ID};";
     public const string DELETE_BY_INSTANCE = $@"DELETE FROM hook WHERE instance_id = {INSTANCE_ID};";
 }

 internal class QRY_RUNTIME {
    public const string EXISTS_BY_ID = $@"SELECT 1 FROM runtime WHERE id = {ID} LIMIT 1;";
    public const string EXISTS_BY_KEY = $@"SELECT 1 FROM runtime WHERE instance_id = {INSTANCE_ID} AND state_id = {STATE_ID} AND activity = {ACTIVITY_ID} AND actor_id = {ACTOR_ID} LIMIT 1;";

    public const string GET_BY_ID = $@"SELECT instance_id, activity, state_id, actor_id, status, created, modified, id FROM runtime WHERE id = {ID} LIMIT 1;";
    public const string GET_BY_KEY = $@"SELECT instance_id, activity, state_id, actor_id, status, created, modified, id FROM runtime WHERE instance_id = {INSTANCE_ID} AND state_id = {STATE_ID} AND activity = {ACTIVITY_ID} AND actor_id = {ACTOR_ID} LIMIT 1;";

    public const string LIST_BY_INSTANCE = $@"SELECT instance_id, activity, state_id, actor_id, status, created, modified, id FROM runtime WHERE instance_id = {INSTANCE_ID} ORDER BY id DESC;";
    public const string LIST_BY_INSTANCE_AND_STATE = $@"SELECT instance_id, activity, state_id, actor_id, status, created, modified, id FROM runtime WHERE instance_id = {INSTANCE_ID} AND state_id = {STATE_ID} ORDER BY id DESC;";
    public const string LIST_BY_INSTANCE_STATE_ACTIVITY = $@"SELECT instance_id, activity, state_id, actor_id, status, created, modified, id FROM runtime WHERE instance_id = {INSTANCE_ID} AND state_id = {STATE_ID} AND activity = {ACTIVITY_ID} ORDER BY id DESC;";

    public const string INSERT = $@"INSERT INTO runtime (instance_id, activity, state_id, actor_id, status) VALUES ({INSTANCE_ID}, {ACTIVITY_ID}, {STATE_ID}, {ACTOR_ID}, {STATUS_ID});";
    public const string UPSERT_BY_KEY_RETURN_ID = $@"INSERT INTO runtime (instance_id, activity, state_id, actor_id, status) VALUES ({INSTANCE_ID}, {ACTIVITY_ID}, {STATE_ID}, {ACTOR_ID}, {STATUS_ID}) ON DUPLICATE KEY UPDATE status = VALUES(status), modified = CURRENT_TIMESTAMP(), id = LAST_INSERT_ID(id);";

    public const string SET_STATUS = $@"UPDATE runtime SET status = {STATUS_ID}, modified = CURRENT_TIMESTAMP() WHERE id = {ID};";

    public const string DELETE = $@"DELETE FROM runtime WHERE id = {ID};";
    public const string DELETE_BY_INSTANCE = $@"DELETE FROM runtime WHERE instance_id = {INSTANCE_ID};";
}

  internal class QRY_RUNTIME_DATA {
      public const string EXISTS_BY_ID = $@"SELECT 1 FROM runtime_data WHERE runtime = {ID} LIMIT 1;";
      public const string GET_BY_ID = $@"SELECT runtime, data, payload FROM runtime_data WHERE runtime = {ID} LIMIT 1;";
      public const string UPSERT = $@"INSERT INTO runtime_data (runtime, data, payload) VALUES ({ID}, {DATA}, {PAYLOAD}) ON DUPLICATE KEY UPDATE data = VALUES(data), payload = VALUES(payload);";
      public const string DELETE = $@"DELETE FROM runtime_data WHERE runtime = {ID};";
  }

      internal class QueryFields {
        public const string ID = "@ID";
        public const string PARENT_ID = "@PARENT_ID";

        public const string NAME = "@NAME";
        public const string CODE = "@CODE";
        public const string GUID = "@GUID";
        public const string HASH = "@HASH";

        public const string DISPLAY_NAME = "@DISPLAY_NAME";
        public const string DESCRIPTION = "@DESCRIPTION";
        public const string CONTENT = "@CONTENT";
        public const string DATA = "@DATA";
        public const string PAYLOAD = "@PAYLOAD";
        public const string VERSION = "@VERSION";

        public const string INSTANCE_ID = "@INSTANCE_ID";
        public const string EXTERNAL_REF = "@EXTERNAL_REF";
        public const string POLICY_ID = "@POLICY_ID";
        public const string CONSUMER = "@CONSUMER";
        public const string MAX_RETRY = "@MAX_RETRY";

        public const string STATE_ID = "@STATE_ID";
        public const string FROM_ID = "@FROM_ID";
        public const string TO_ID = "@TO_ID";
        public const string EVENT_ID = "@EVENT_ID";

        public const string FLAGS = "@FLAGS";

        public const string ACTOR = "@ACTOR";
        public const string ACTOR_ID = "@ACTOR_ID";

        public const string ON_ENTRY = "@ON_ENTRY";
        public const string ROUTE = "@ROUTE";

        public const string ACK_ID = "@ACK_ID";
        public const string LC_ID = "@LC_ID";
        public const string HOOK_ID = "@HOOK_ID";
        public const string CONSUMER_ID = "@CONSUMER_ID";
        public const string SOURCE_ID = "@SOURCE_ID";
        public const string ACK_STATUS = "@ACK_STATUS";
        public const string OLDER_THAN = "@OLDER_THAN";

        public const string ACTIVITY_ID = "@ACTIVITY_ID";
        public const string STATUS_ID = "@STATUS_ID";

        public const string TAKE = "@TAKE";
        public const string SKIP = "@SKIP";
    }